<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Independent Means Results (More Than 2 Groups)</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{--surface-0:#0c1624;--surface-1:#1a1f2e;--surface-2:#242938;--border:#2d3748;--accent-1:rgb(255,165,120);--accent-2:rgb(120,200,255);--text-primary:#fff;--text-secondary:rgba(255,255,255,.82);--text-muted:rgba(255,255,255,.62);--panel-radius:10px;--panel-shadow:0 4px 20px rgba(0,0,0,.4);}
    html,body{height:100%;margin:0;background:var(--surface-0);color:var(--text-primary);font-family:Segoe UI,Tahoma,sans-serif;}
    .wrap{display:flex;justify-content:center;padding:8px 12px 20px;}
    .card{/* width:min(1600px,99%); *//* background:var(--surface-1); */min-height:760px;border-radius:var(--panel-radius);box-shadow:var(--panel-shadow);border:1px solid var(--border);display:flex;flex-direction:column;}
    .hero-section{background:linear-gradient(180deg,#0a1118,#0c1620);border-bottom:1px solid rgba(255,255,255,.06);padding:16px 20px;border-radius:var(--panel-radius) var(--panel-radius) 0 0;}
    .hero-content{display:flex;justify-content:space-between;align-items:center;gap:12px;}
    .hero-title{display:flex;align-items:center;/* gap:12px; */font-size:1.28rem;font-weight:800;letter-spacing:.4px;text-transform:uppercase;}
    .hero-controls{display:flex;align-items:center;gap:10px;}
    .hero-action-btn{border-radius:8px;border:1px solid rgba(148,163,184,.45);background:linear-gradient(145deg,rgba(148,163,184,.18),rgba(100,116,139,.16));color:#fff;padding:10px 16px;font-size:12px;font-weight:650;cursor:pointer;display:flex;align-items:center;gap:8px;position:relative;}
    .hero-action-btn:hover::after{content:attr(title);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:8px;padding:8px 12px;background:#283593;color:#fff;font-size:11px;font-weight:600;white-space:nowrap;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:1000;pointer-events:none;}
    .hero-action-btn:hover::before{content:'';position:absolute;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:2px;border:6px solid transparent;border-top-color:#283593;z-index:1000;pointer-events:none;}
    .design-warning{margin-top:8px;padding:8px 16px;background:transparent;border-left:4px solid #ff9800;color:#e65100;font-size:12px;font-weight:600;text-align:center;}
    .tab-navigation{display:flex;align-items:flex-end;gap:16px;background:transparent;padding:12px 0 0;border-bottom:1px solid rgba(255,255,255,.08);overflow-x:auto;scrollbar-width:none;margin-top:10px;}
    .tab-button{height:36px;padding:0 4px;background:transparent;border:none;color:rgba(255,255,255,.55);font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:7px;position:relative;}
    .tab-button.active{color:#fff;font-weight:700;}
    .tab-button.active::before{content:'';position:absolute;left:0;right:0;bottom:-9px;height:2px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));}
    .tab-controls-right{margin-left:auto;display:inline-flex;align-items:center;gap:8px;padding-bottom:8px;}
    .tab-decimal-select{height:36px;padding:0 10px;border-radius:8px;border:1px solid rgba(148,163,184,.45);background:rgba(15,23,42,.82);color:#fff;}
    .view-container{padding:14px 16px;}
    .tab-panel{display:none;} .tab-panel.active{display:block;}
    .stats-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px;}
    .stat-panel{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
    .stat-panel.secondary{opacity:0.7;transform:scale(0.95);border-color:rgba(45,55,72,0.4);}
    .stat-panel.secondary .stat-panel-heading{background:#37474f;font-size:11px;padding:7px 10px;border-bottom:1px solid rgba(255,165,120,.4);}
    .stat-panel.secondary .stat-field{padding:6px 0;}
    .stat-panel.secondary .stat-label{font-size:13px;opacity:0.85;}
    .stat-panel.secondary .stat-value{font-size:13px;padding:5px 8px;min-width:100px;opacity:0.9;}
    .stat-panel-heading{padding:9px 12px;background:#164e8d;color:#fff;font-weight:700;text-transform:uppercase;letter-spacing:.3px;border-bottom:2px solid rgba(255,165,120,.7);}
    .stat-panel-heading.parametric{background:#2e5f8a;border-bottom-color:#4a90e2;}
    .stat-panel-heading.nonparametric{background:#00695c;border-bottom-color:#26a69a;}
    .stat-panel-body{padding:8px 12px;}
    .stat-field{display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.06);}
    .stat-field:last-child{border-bottom:none;}
    .stat-label{color:var(--text-secondary);font-weight:600;}
    .stat-value{font-variant-numeric:tabular-nums;color:var(--accent-2);font-weight:700;background:rgba(120,200,255,.12);border:1px solid rgba(120,200,255,.32);padding:6px 10px;border-radius:8px;min-width:110px;text-align:center;}
    .table-container{margin-top:10px;overflow:auto;max-height:420px;}
    .analysis-table{width:100%;border-collapse:collapse;}
    .analysis-table th{background:#164e8d;color:#fff;padding:8px;border:1px solid rgba(255,255,255,.2);}
    .analysis-table td{padding:8px;border:1px solid rgba(255,255,255,.14);color:var(--text-secondary);}
    .section-note{margin-top:10px;padding:9px;border-left:3px solid var(--accent-1);background:rgba(255,165,120,.1);color:var(--text-muted);}
    .framework-select{height:34px;padding:0 10px;border-radius:8px;border:1px solid rgba(148,163,184,.45);background:rgba(15,23,42,.82);color:#fff;}
    .agreement-good{color:#4ade80;font-weight:700;}
    .agreement-warn{color:#fbbf24;font-weight:700;}
    .settings-bar{margin-top:8px;background:linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);border:2px solid #5c6bc0;border-radius:0;padding:8px 10px;box-shadow:0 2px 8px rgba(92,107,192,0.15);}
    .settings-panel-title{font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:#283593;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #5c6bc0;}
    .settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:6px;}
    .settings-grid>div{display:flex;flex-direction:column;}
    .settings-grid label{font-size:11px;color:#37474f;margin-bottom:2px;font-weight:700;text-transform:uppercase;}
    .settings-grid select,.settings-grid input{width:100%;height:32px;border-radius:0;border:2px solid #5c6bc0;background:#ffffff;color:#263238;padding:0 8px;font-weight:600;}
    #setPosthocWrap,#setCorrectionWrap{min-width:180px;max-width:220px;display:flex;flex-direction:column;align-items:flex-start;gap:4px;}
    #setPosthocWrap label,#setCorrectionWrap label{white-space:nowrap;line-height:1.1;margin-bottom:0;}
    .inference-row{display:flex;align-items:center;justify-content:flex-start;gap:12px;flex-wrap:nowrap;min-width:max-content;}
    .inference-card{display:flex;align-items:center;gap:8px;flex-wrap:nowrap;justify-content:flex-start;padding:0;border:0;border-radius:0;background:transparent;min-width:max-content;}
    .inference-card#primaryTestWrap{flex:0 0 auto;min-width:200px;max-width:220px;}
    .inference-title{display:none;}
    .fw-radio-group{display:flex;border:0;border-radius:0;overflow:hidden;min-width:360px;gap:6px;}
    .fw-radio-group input{display:none;}
    .fw-radio{padding:10px 16px;color:#fff;font-size:14px;font-weight:800;cursor:pointer;user-select:none;border:3px solid transparent;box-shadow:0 2px 8px rgba(0,0,0,0.1);text-transform:uppercase;letter-spacing:0.5px;opacity:0.6;flex:1;text-align:center;position:relative;}
    .fw-radio:last-of-type{border-right:3px solid transparent;}
    .fw-radio.active{opacity:1;box-shadow:0 4px 12px rgba(0,0,0,0.3);transform:translateY(-2px);transition:all 0.2s ease;border-color:currentColor;}
    .fw-radio.active::before{content:'✓';position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:18px;font-weight:900;}
    .fw-radio#setFrameworkParam{background:#4a90e2;color:#fff;}
    .fw-radio#setFrameworkParam.active{background:#2e5f8a;border-color:#4a90e2;}
    .fw-radio#setFrameworkNon{background:#26a69a;color:#fff;}
    .fw-radio#setFrameworkNon.active{background:#00695c;border-color:#26a69a;}
    .primary-test-wrap{display:flex;align-items:center;gap:8px;min-width:280px;}
    .test-now{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;border:1px solid rgba(16,185,129,.45);background:rgba(16,185,129,.14);color:#d1fae5;font-size:12px;font-weight:800;}
    .primary-test-wrap label{font-size:11px;color:var(--text-muted);font-weight:800;text-transform:uppercase;}
    .primary-test-wrap select{height:38px;width:100%;border-radius:0;border:3px solid transparent;background:#2e5f8a;color:#ffffff;padding:0 12px;font-weight:700;font-size:14px;box-shadow:0 2px 8px rgba(0,0,0,0.15);text-align:center;text-align-last:center;}
    .primary-test-wrap select.parametric{background:#2e5f8a;border-color:#4a90e2;color:#ffffff;box-shadow:0 3px 10px rgba(46,95,138,0.4);}
    .primary-test-wrap select.nonparametric{background:#00695c;border-color:#26a69a;color:#ffffff;box-shadow:0 3px 10px rgba(0,105,92,0.4);}
    #setPrimaryTest:disabled{appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:none !important;cursor:default;padding-right:8px !important;}
    select:disabled{appearance:none;-webkit-appearance:none;-moz-appearance:none;}
    .hbox{border:1px solid rgba(148,163,184,.38);border-radius:10px;padding:8px;background:rgba(6,16,30,.55);}
    .hbox-title{font-size:11px;color:var(--text-muted);text-transform:uppercase;font-weight:700;margin-bottom:6px;}
    .hbox-row{display:flex;align-items:center;gap:10px;flex-wrap:nowrap;color:#e5eefc;}
    .h-radio{display:inline-flex;align-items:center;gap:5px;font-size:12px;color:#263238;text-transform:none !important;white-space:nowrap;font-weight:600;}
    .h-radio input{transform:scale(0.9);}
    .hdr-row{display:flex;justify-content:flex-start;align-items:center;gap:10px;flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;padding-bottom:2px;scrollbar-width:thin;}
    .stat-chip{display:inline-flex;align-items:center;gap:4px;background:#e3f2fd;border:2px solid #1976d2;border-radius:0;padding:4px 8px;font-size:11px;color:#0d47a1;font-weight:700;}
    .test-chip{display:inline-flex;align-items:center;background:rgba(16,185,129,.16);border:1px solid rgba(16,185,129,.55);color:#d1fae5;border-radius:8px;padding:8px 12px;font-size:12px;font-weight:700;}
    .hyp-card{border:2px solid #5c6bc0;border-radius:0;padding:8px 10px;background:#ffffff;}
    .hyp-row{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}

    .hyp-main{font-size:15px;font-weight:700;color:#283593;white-space:nowrap;min-width:240px;}
    .hyp-block{display:flex;align-items:center;gap:10px;white-space:nowrap;}
    .hyp-h1-label{font-size:12px;color:#37474f;font-weight:800;text-transform:uppercase;letter-spacing:.2px;}
    .hyp-options{display:flex;align-items:center;gap:12px;white-space:nowrap;}
    .hyp-delta{font-weight:800;color:#93c5fd;}
    .alpha-wrap{min-width:280px;max-width:340px;}
    .alpha-wrap label{font-size:11px;color:#37474f;font-weight:800;text-transform:uppercase;}
    #setAlpha{height:4px;opacity:.78;accent-color:#3949ab;max-width:211px;}
    .hyp-h1-label{
  font-size:11px;
  color:#37474f;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:.3px;
  margin-bottom:4px;
}

  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <div class="hero-section">
        <div class="hero-content">
          <div class="hero-title"><span>Independent Means Module (>2 Groups)</span></div>
          <div class="hero-controls">
            <button class="hero-action-btn" onclick="saveCurrentModel()" title="Save model configuration to Excel workbook">
              <i class="fa-solid fa-floppy-disk"></i> Model
            </button>
            <button class="hero-action-btn" onclick="exportHtml()" title="Export complete report as standalone HTML file">
              <i class="fa-solid fa-floppy-disk"></i> HTML
            </button>
          </div>
        </div>
        <div class="tab-navigation">
          <button class="tab-button active" data-tab="explore"><i class="fa-solid fa-chart-column"></i> Explore</button>
          <button class="tab-button" data-tab="assumptions"><i class="fa-solid fa-shield-halved"></i> Assumptions</button>
          <button class="tab-button" data-tab="results"><i class="fa-solid fa-square-poll-vertical"></i> Results</button>
          <button class="tab-button" data-tab="effects"><i class="fa-solid fa-wave-square"></i> Effects</button>
          <button class="tab-button" data-tab="power"><i class="fa-solid fa-bolt"></i> Power</button>
          <button class="tab-button" data-tab="report"><i class="fa-solid fa-file-lines"></i> Report</button>
          <div class="tab-controls-right">
            <label for="decimalSelect">Decimals:</label>
            <select id="decimalSelect" class="tab-decimal-select" onchange="setDecimalPrecision()">
              <option value="auto">Auto</option><option value="0">0</option><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option>
            </select>
          </div>
        </div>

        <div class="settings-bar">
  <div class="settings-panel-title">Test Configuration Panel (>2 Groups)</div>
  <div class="settings-grid">








    <!-- Comparison chips + design message -->
    <div style="grid-column:1/-1;">
      <div class="hdr-row" id="compareStatsRow"></div>
      <div id="designMessageRow" class="design-warning" style="display:none;"></div>
    </div>

    <!-- Inference + Test method (side by side, clearly separated) -->
    <div style="grid-column:1/-1;">
      <div class="hdr-row">
        <div class="inference-row">

          <!-- Inference Type (left) -->
          <div class="inference-card" style="flex:0 0 auto;">
            <div class="inference-title">Inference type</div>
            <div class="fw-radio-group" role="radiogroup" aria-label="Inference type">
              <input id="fwParametric" type="radio" name="frameworkMode" value="parametric" checked/>
              <label for="fwParametric" id="setFrameworkParam" class="fw-radio active">Parametric (means)</label>
              <input id="fwNonparametric" type="radio" name="frameworkMode" value="nonparametric"/>
              <label for="fwNonparametric" id="setFrameworkNon" class="fw-radio">Non-parametric (ranks)</label>
            </div>
          </div>

          <!-- Test Method (right) -->
          <div class="inference-card" id="primaryTestWrap" style="flex:1 1 auto;min-width:280px;">
            <div class="inference-title">Test method</div>
            <select id="setPrimaryTest" style="width:100%;height:42px;font-size:14px;padding:0 12px;border-radius:10px;border:1px solid rgba(120,200,255,.45);background:rgba(15,23,42,.95);color:#fff;font-weight:600;">
              <option value="welch">Welch t-test (recommended)</option>
              <option value="student">Student t-test (equal variance)</option>
              <option value="permutation">Permutation test (mean difference)</option>
            </select>
          </div>

          <!-- Post-hoc controls (visible only for k+ groups) -->
          <div id="setPosthocWrap" style="display:none;flex:0 0 auto;">
            <label for="setPosthocMethod">Post-hoc</label>
            <select id="setPosthocMethod">
              <option value="games-howell">Games-Howell</option>
              <option value="tukey">Tukey HSD</option>
              <option value="dunn">Dunn</option>
              <option value="conover">Conover</option>
            </select>
          </div>

          <div id="setCorrectionWrap" style="display:none;flex:0 0 auto;">
            <label for="setPosthocCorrection">p Correction</label>
            <select id="setPosthocCorrection">
              <option value="holm">Holm</option>
              <option value="bh">Benjamini-Hochberg</option>
              <option value="bonferroni">Bonferroni</option>
              <option value="none">None</option>
            </select>
          </div>

        </div>
      </div>
    </div>

    <!-- (Removed from original position) -->

    <!-- Hypothesis + alpha (compact, less clutter) -->
    <div id="setHypWrap" style="grid-column:1/-1;">
      <div class="hyp-card">
        <div class="hyp-row">

          <div class="hyp-block hyp-main">
            <strong>H0:</strong> <span id="h0Text">Difference = 0</span>
          </div>

          <div class="hyp-block">

  <div class="hyp-h1-label">Alternative (H1)</div>

  <div class="hbox-row hyp-options" id="h1Row">
    <label class="h-radio">
      <input type="radio" name="h1Orientation" value="less"/>
      Difference &lt; 0
    </label>

    <label class="h-radio">
      <input type="radio" name="h1Orientation" value="two-sided" checked/>
      Difference ≠ 0
    </label>

    <label class="h-radio">
      <input type="radio" name="h1Orientation" value="greater"/>
      Difference &gt; 0
    </label>
  </div>

</div>



          <div class="alpha-wrap">
            <label for="setAlpha" style="font-size:10px;opacity:0.75;">
              Significance: <span id="alphaVal">0.050</span>
            </label>
            <input id="setAlpha" type="range" min="0.001" max="0.2" step="0.001" value="0.05" style="height:3px;"/>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>


        
      <div class="view-container">
        <section id="tab-explore" class="tab-panel active">
          <div class="stats-container">
            <div class="stat-panel"><div class="stat-panel-heading">Group Summaries</div><div class="stat-panel-body">
              <div class="stat-field"><span class="stat-label">Variables compared</span><span class="stat-value" id="expVarCount">...</span></div>
              <div class="stat-field"><span class="stat-label">Total N</span><span class="stat-value" id="expTotalN">...</span></div>
              <div class="stat-field"><span class="stat-label">Levels</span><span class="stat-value" id="expLevels">...</span></div>
              <div class="stat-field"><span class="stat-label">Overall mean</span><span class="stat-value" id="expOverallMean">...</span></div>
              <div class="stat-field"><span class="stat-label">Primary framework</span><span class="stat-value" id="expFramework">...</span></div>
            </div></div>
          </div>
        </section>
        <section id="tab-assumptions" class="tab-panel">
          <div class="stats-container"><div class="stat-panel"><div class="stat-panel-heading">Diagnostics</div><div class="stat-panel-body">
            <div class="stat-field"><span class="stat-label">Levene p-value</span><span class="stat-value" id="asLeveneP">...</span></div>
            <div class="stat-field"><span class="stat-label">Brown-Forsythe p-value</span><span class="stat-value" id="asBfP">...</span></div>
            <div class="stat-field"><span class="stat-label">Welch ANOVA p-value</span><span class="stat-value" id="asWelchP">...</span></div>
            <div class="stat-field"><span class="stat-label">Recommendation</span><span class="stat-value" id="asReco">...</span></div>
          </div></div></div>
        </section>
        <section id="tab-results" class="tab-panel">
          <div class="stat-panel">
            <div class="stat-panel-heading">Independent Measures ANOVA</div>
            <div class="stat-panel-body" style="padding:10px;">
              <div class="table-container" style="margin:0;max-height:none;">
                <table class="analysis-table">
                  <thead>
                    <tr><th>Source</th><th>SS</th><th>df</th><th>MS</th><th>F</th><th>p-value</th></tr>
                  </thead>
                  <tbody id="anovaSummaryBody">
                    <tr><td>Treatments</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
                    <tr><td>Within groups</td><td>...</td><td>...</td><td>...</td><td>-</td><td>-</td></tr>
                    <tr><td>Total</td><td>...</td><td>...</td><td>-</td><td>-</td><td>-</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="stats-container" style="margin-top:12px;">
            <div class="stat-panel">
              <div class="stat-panel-heading">Effect Size</div>
              <div class="stat-panel-body">
                <div class="stat-field"><span class="stat-label">Eta squared</span><span class="stat-value" id="kEtaSquared">...</span></div>
                <div class="stat-field"><span class="stat-label">Cohen's f</span><span class="stat-value" id="kCohenF">...</span></div>
              </div>
            </div>
            <div class="stat-panel secondary">
              <div class="stat-panel-heading">Robustness Test of Equality of Means</div>
              <div class="stat-panel-body">
                <div class="table-container" style="margin:0;max-height:none;">
                  <table class="analysis-table">
                    <thead>
                      <tr><th>Equality of Variance Test</th><th>F Statistic</th><th>df1</th><th>df2</th><th>p-value</th></tr>
                    </thead>
                    <tbody id="varianceTestBody">
                      <tr><td>Levene test</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
                      <tr><td>Brown-Forsythe</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="table-container" style="margin-top:10px;max-height:none;">
                  <table class="analysis-table">
                    <thead>
                      <tr><th>Welch ANOVA</th><th>df1</th><th>df2</th><th>F Statistic</th><th>p-value</th></tr>
                    </thead>
                    <tbody id="welchAnovaBody">
                      <tr><td>Welch</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="stat-panel" style="margin-top:12px;">
            <div class="stat-panel-heading">Parametric vs Nonparametric</div>
            <div class="stat-panel-body" style="padding:0;">
              <div class="table-container" style="margin:0;max-height:none;">
                <table class="analysis-table">
                  <thead><tr><th>Parametric</th><th>Nonparametric</th></tr></thead>
                  <tbody id="methodComparisonBody">
                    <tr><td>ANOVA F: ...</td><td>Kruskal H: ...</td></tr>
                    <tr><td>Means: ...</td><td>Mean ranks: ...</td></tr>
                    <tr><td>η² / ω²: ... / ...</td><td>ε² / η²(H): ... / ...</td></tr>
                    <tr><td>Post-hoc: Tukey / Games-Howell</td><td>Post-hoc: Dunn / Conover</td></tr>
                    <tr><td>Levene p: ...</td><td>Tie/normality info: rank-based robust</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="stat-panel" id="posthocPanel" style="margin-top:12px; display:none;">
            <div class="stat-panel-heading">Post-hoc Pairwise</div>
            <div class="stat-panel-body" style="padding:0;">
              <div class="table-container" style="margin:0;">
                <table class="analysis-table">
                  <thead><tr><th>Comparison</th><th>Statistic</th><th>Raw p</th><th>Adj p</th><th>Estimate</th></tr></thead>
                  <tbody id="posthocBody"><tr><td colspan="5">No post-hoc rows</td></tr></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
        <section id="tab-effects" class="tab-panel">
          <div class="stats-container"><div class="stat-panel"><div class="stat-panel-heading">Effect Sizes</div><div class="stat-panel-body">
            <div class="stat-field"><span class="stat-label">Eta squared</span><span class="stat-value" id="efEta">...</span></div>
            <div class="stat-field"><span class="stat-label">Cohen's f</span><span class="stat-value" id="efCohenF">...</span></div>
            <div class="stat-field"><span class="stat-label">ANOVA F</span><span class="stat-value" id="efAnovaF">...</span></div>
            <div class="stat-field"><span class="stat-label">Kruskal H</span><span class="stat-value" id="efKwH">...</span></div>
          </div></div></div>
        </section>
        <section id="tab-power" class="tab-panel">
          <div class="stats-container"><div class="stat-panel"><div class="stat-panel-heading">Power & Sample Size (Python)</div><div class="stat-panel-body">
            <div class="stat-field"><span class="stat-label">Status</span><span class="stat-value" id="powNote">...</span></div>
            <div class="stat-field"><span class="stat-label">Endpoint</span><span class="stat-value" id="powEndpoint">...</span></div>
            <div class="stat-field"><span class="stat-label">Placeholder Power</span><span class="stat-value" id="powVal">...</span></div>
          </div></div></div>
          <div class="section-note">Power is designed to call a Python service endpoint with exact/simulation routines.</div>
        </section>
        <section id="tab-report" class="tab-panel">
          <div class="stat-panel"><div class="stat-panel-heading">APA-ready Report</div><div class="stat-panel-body">
            <div id="repAnova"></div><br/><div id="repKw"></div><br/><div id="repCons"></div>
          </div></div>
        </section>
      </div>
    </section>
  </div>
  <script>
    let globalDecimalPrecision = "auto";
    let lastBundle = null;
    let primaryFramework = "parametric";
    let availableHeaders = [];
    let currentCompareMode = "k-plus";
    let currentHypothesis = "two-sided";
    let currentPrimaryTest = "welch";
    let persistedColumns = { groupA: "", groupB: "", valueColumn: "", groupColumn: "" };
    function parseMaybeNumber(v){ if(v===undefined||v===null) return NaN; const n=Number(String(v).replace(",",".")); return isFinite(n)?n:NaN; }
    function fmt(v){ const n=parseMaybeNumber(v); if(!isFinite(n)) return v==null?"...":String(v); if(globalDecimalPrecision==="auto"){ if(Math.abs(n)<1&&n!==0) return n.toFixed(4); return n.toFixed(2);} return n.toFixed(parseInt(globalDecimalPrecision,10)); }
    function fmtP(v){ const n=parseMaybeNumber(v); if(!isFinite(n)) return v==null?"...":String(v); if(n < 0.001) return "< 0.001"; return globalDecimalPrecision === "auto" ? n.toFixed(4) : n.toFixed(Math.max(3, parseInt(globalDecimalPrecision,10))); }
    function setDecimalPrecision(){ globalDecimalPrecision=(document.getElementById("decimalSelect")||{value:"auto"}).value; if(lastBundle) populateBundle(lastBundle); }
    function setText(id,val){ const el=document.getElementById(id); if(el) el.textContent = (val!==undefined&&val!==null&&val!=="")?val:"..."; }
    let activeTab = "explore";
    function switchTab(tab){
      if (!tab || tab === activeTab) return;
      const prevBtn = document.querySelector('.tab-button[data-tab="' + activeTab + '"]');
      const nextBtn = document.querySelector('.tab-button[data-tab="' + tab + '"]');
      const prevPanel = document.getElementById("tab-" + activeTab);
      const nextPanel = document.getElementById("tab-" + tab);
      if (prevBtn) prevBtn.classList.remove("active");
      if (nextBtn) nextBtn.classList.add("active");
      if (prevPanel) prevPanel.classList.remove("active");
      if (nextPanel) nextPanel.classList.add("active");
      activeTab = tab;
    }
    function sendToHost(cmd,data){ if(Office&&Office.context&&Office.context.ui&&Office.context.ui.messageParent) Office.context.ui.messageParent(JSON.stringify({action:"HOST_EVENT",cmd:cmd,data:data||{}})); }
    function fillSelect(id, options, selected){
      const el = document.getElementById(id);
      if (!el) return;
      el.innerHTML = (options || []).map(function(v){ return '<option value="' + v + '">' + v + '</option>'; }).join("");
      if (selected !== undefined && selected !== null && String(selected) !== "") el.value = String(selected);
    }
    function currentSettingsSpec(){
      var hChecked = document.querySelector('input[name="h1Orientation"]:checked');
      var h = hChecked ? hChecked.value : "two-sided";
      currentHypothesis = h;
      var alpha = Number((document.getElementById("setAlpha") || { value: "0.05" }).value || 0.05);
      if (!isFinite(alpha) || alpha <= 0 || alpha >= 1) alpha = 0.05;
      return {
        compareMode: currentCompareMode,
        primaryFramework: primaryFramework,
        hypothesis: h,
        confidence: 1 - alpha,
        groupA: persistedColumns.groupA || "",
        groupB: persistedColumns.groupB || "",
        valueColumn: persistedColumns.valueColumn || "",
        groupColumn: persistedColumns.groupColumn || "",
        primaryTest: (document.getElementById("setPrimaryTest") || {}).value || currentPrimaryTest || "welch",
        posthocMethod: (document.getElementById("setPosthocMethod") || {}).value || "games-howell",
        posthocCorrection: (document.getElementById("setPosthocCorrection") || {}).value || "holm"
      };
    }
    function refreshHypothesisFrames(){
      var h0 = document.getElementById("h0Text");
      var h1Row = document.getElementById("h1Row");
      if (!h0 || !h1Row) return;
      h0.textContent = "All groups are equal";
      h1Row.innerHTML = '<span style="color:#1f2937;font-weight:800;">At least one group differs.</span>';
    }
    function refreshSettingsVisibility(){
      const setDisplay = (id, show) => { const el = document.getElementById(id); if (el) el.style.display = show ? "flex" : "none"; };
      setDisplay("setPosthocWrap", true); setDisplay("setCorrectionWrap", true);
      setDisplay("setHypWrap", true);
      refreshHypothesisFrames();
    }
    function updatePosthocOptions(){
      var sel = document.getElementById("setPosthocMethod");
      if (!sel) return;
      var isNonParam = primaryFramework === "nonparametric" || currentPrimaryTest === "kruskal";
      var options = isNonParam
        ? [
            { v: "dunn", t: "Dunn" },
            { v: "conover", t: "Conover" }
          ]
        : [
            { v: "games-howell", t: "Games-Howell" },
            { v: "tukey", t: "Tukey HSD" }
          ];
      var current = sel.value;
      sel.innerHTML = options.map(function(o){ return '<option value="' + o.v + '">' + o.t + '</option>'; }).join("");
      var keep = options.some(function(o){ return o.v === current; });
      sel.value = keep ? current : options[0].v;
    }
    function setFrameworkButtons(mode){
      primaryFramework = mode === "nonparametric" ? "nonparametric" : "parametric";
      var p = document.getElementById("setFrameworkParam");
      var n = document.getElementById("setFrameworkNon");
      if (p) p.classList.toggle("active", primaryFramework === "parametric");
      if (n) n.classList.toggle("active", primaryFramework === "nonparametric");
      var rp = document.getElementById("fwParametric");
      var rn = document.getElementById("fwNonparametric");
      if (rp) rp.checked = primaryFramework === "parametric";
      if (rn) rn.checked = primaryFramework === "nonparametric";
      var primaryTestWrap = document.getElementById("primaryTestWrap");
      if (primaryTestWrap) primaryTestWrap.style.display = "flex";
      var testSel = document.getElementById("setPrimaryTest");
      if (testSel) testSel.className = primaryFramework === "nonparametric" ? "nonparametric" : "parametric";
      document.querySelectorAll(".stat-panel-heading").forEach(function(h){
        h.classList.remove("parametric", "nonparametric");
        h.classList.add(primaryFramework);
      });
      if (testSel) {
        var options = primaryFramework === "nonparametric"
          ? [{ v: "kruskal", t: "Kruskal-Wallis" }]
          : [{ v: "anova", t: "One-way ANOVA" }];
        testSel.innerHTML = options.map(function(o){ return '<option value="' + o.v + '">' + o.t + '</option>'; }).join("");
        currentPrimaryTest = options[0].v;
        testSel.value = currentPrimaryTest;
        testSel.disabled = true;
      }
      updatePosthocOptions();
      refreshHypothesisFrames();
    }
    function notifySettingsChanged(){
      const spec = currentSettingsSpec();
      refreshSettingsVisibility();
      var alphaVal = document.getElementById("alphaVal");
      if (alphaVal) alphaVal.textContent = (1 - (spec.confidence || 0.95)).toFixed(3);
      sendToHost("independentSettingsChanged", spec);
    }
    function renderCompareStatsRow(s, e){
      var host = document.getElementById("compareStatsRow");
      var msgHost = document.getElementById("designMessageRow");
      if (!host) return;
      host.innerHTML = "";
      if (msgHost) { msgHost.textContent = ""; msgHost.style.display = "none"; }
      var ksum = e.kplusSummary || {};
      var colStats = Array.isArray(e.selectedColumnStats) ? e.selectedColumnStats.filter(function(cs){
        return isFinite(parseMaybeNumber(cs && cs.n)) && parseMaybeNumber(cs.n) > 0;
      }).slice(0, 8) : [];
      if (colStats.length) {
        colStats.forEach(function(cs){
          var n = parseMaybeNumber(cs.n);
          var m = parseMaybeNumber(cs.mean);
          var chip = document.createElement("span");
          chip.className = "stat-chip";
          chip.textContent = (cs.name || "Variable") + " (n=" + (isFinite(n) ? n : "?") + ", μ=" + (isFinite(m) ? fmt(m) : "?") + ")";
          chip.style.fontSize = "11px";
          host.appendChild(chip);
        });
      } else {
        var summaryChip = document.createElement("span");
        summaryChip.className = "stat-chip";
        summaryChip.textContent = "Variables: " + (isFinite(parseMaybeNumber(ksum.variableCount)) ? parseMaybeNumber(ksum.variableCount) : ((s.groupLevels || []).length || 0));
        host.appendChild(summaryChip);
      }
      var design = s.designValidation || {};
      if (msgHost) {
        if (design.message) {
          msgHost.textContent = design.message;
          msgHost.style.display = "block";
        } else {
          msgHost.textContent = "";
          msgHost.style.display = "none";
        }
      }
    }
    function updateResultsPanels(r, fx, s, a){
      setText("resPrimaryFramework", primaryFramework === "nonparametric" ? "Nonparametric (ranks)" : "Parametric (means)");
      const alpha = isFinite(parseMaybeNumber(a)) ? parseMaybeNumber(a) : (1 - (parseMaybeNumber(s && s.confidence) || 0.95));
      if (r && r.omnibus) {
        const ob = r.omnibus;
        const paramPrimary = primaryFramework !== "nonparametric";
        if (paramPrimary) {
          setText("resPrimaryTest", "One-way ANOVA");
          setText("resPrimaryStat", "F(" + fmt(ob.anovaDf1) + ", " + fmt(ob.anovaDf2) + ") = " + fmt(ob.anovaF));
          setText("resPrimaryP", fmtP(ob.anovaP));
          setText("resPrimaryEstimate", "Omnibus effect across " + fmt(ob.levels ? ob.levels.length : 0) + " groups");
          setText("resSecondaryTest", "Kruskal-Wallis");
          setText("resSecondaryStat", "H(" + fmt(ob.kwDf) + ") = " + fmt(ob.kwH));
          setText("resSecondaryP", fmtP(ob.kwP));
        } else {
          setText("resPrimaryTest", "Kruskal-Wallis");
          setText("resPrimaryStat", "H(" + fmt(ob.kwDf) + ") = " + fmt(ob.kwH));
          setText("resPrimaryP", fmtP(ob.kwP));
          setText("resPrimaryEstimate", "Distribution shift across " + fmt(ob.levels ? ob.levels.length : 0) + " groups");
          setText("resSecondaryTest", "One-way ANOVA");
          setText("resSecondaryStat", "F(" + fmt(ob.anovaDf1) + ", " + fmt(ob.anovaDf2) + ") = " + fmt(ob.anovaF));
          setText("resSecondaryP", fmtP(ob.anovaP));
        }
        const agreeElK = document.getElementById("resAgreement");
        const aSig = parseMaybeNumber(ob.anovaP) < alpha;
        const kSig = parseMaybeNumber(ob.kwP) < alpha;
        if (aSig === kSig) {
          setText("resAgreement", "Agree at alpha");
          if (agreeElK) agreeElK.className = "stat-value agreement-good";
          setText("resHint", "Omnibus conclusions are consistent across frameworks.");
        } else {
          setText("resAgreement", "Disagree at alpha");
          if (agreeElK) agreeElK.className = "stat-value agreement-warn";
          setText("resHint", "Consider non-normality/heteroscedasticity and run post-hoc with correction.");
        }

        // ANOVA summary block
        const anovaBody = document.getElementById("anovaSummaryBody");
        if (anovaBody) {
          const totalDf = Math.max(0, parseMaybeNumber(ob.anovaDf1) + parseMaybeNumber(ob.anovaDf2));
          anovaBody.innerHTML = ''
            + '<tr><td>Treatments</td><td>' + fmt(ob.anovaSSBetween) + '</td><td>' + fmt(ob.anovaDf1) + '</td><td>' + fmt(ob.anovaMSBetween) + '</td><td>' + fmt(ob.anovaF) + '</td><td>' + fmtP(ob.anovaP) + '</td></tr>'
            + '<tr><td>Within groups</td><td>' + fmt(ob.anovaSSWithin) + '</td><td>' + fmt(ob.anovaDf2) + '</td><td>' + fmt(ob.anovaMSWithin) + '</td><td>-</td><td>-</td></tr>'
            + '<tr><td>Total</td><td>' + fmt(ob.anovaSSTotal) + '</td><td>' + fmt(totalDf) + '</td><td>-</td><td>-</td><td>-</td></tr>';
        }
        setText("kEtaSquared", fmt(ob.etaSquared));
        setText("kCohenF", fmt(ob.cohenF));

        const varBody = document.getElementById("varianceTestBody");
        if (varBody) {
          const lv = ob.levene || {};
          const bf = ob.brownForsythe || {};
          varBody.innerHTML = ''
            + '<tr><td>Levene test</td><td>' + fmt(lv.f) + '</td><td>' + fmt(lv.df1) + '</td><td>' + fmt(lv.df2) + '</td><td>' + fmtP(lv.p) + '</td></tr>'
            + '<tr><td>Brown-Forsythe</td><td>' + fmt(bf.f) + '</td><td>' + fmt(bf.df1) + '</td><td>' + fmt(bf.df2) + '</td><td>' + fmtP(bf.p) + '</td></tr>';
        }

        const welchBody = document.getElementById("welchAnovaBody");
        if (welchBody) {
          const wa = ob.welchAnova || {};
          welchBody.innerHTML = '<tr><td>Welch</td><td>' + fmt(wa.df1) + '</td><td>' + fmt(wa.df2) + '</td><td>' + fmt(wa.f) + '</td><td>' + fmtP(wa.p) + '</td></tr>';
        }

        const compareBody = document.getElementById("methodComparisonBody");
        if (compareBody) {
          const explore = (lastBundle && lastBundle.explore) ? lastBundle.explore : {};
          const colStats = Array.isArray(explore.selectedColumnStats) ? explore.selectedColumnStats.filter(function(cs){
            return isFinite(parseMaybeNumber(cs && cs.n)) && parseMaybeNumber(cs.n) > 0;
          }) : [];
          const meansSummary = colStats.slice(0, 3).map(function(cs){
            return (cs.name || "Var") + "=" + fmt(cs.mean);
          }).join(" | ") || "...";
          const meanRanks = ob.meanRanks || {};
          const rankKeys = Object.keys(meanRanks || {}).slice(0, 3);
          const meanRankSummary = rankKeys.length
            ? rankKeys.map(function(k){ return k + "=" + fmt(meanRanks[k]); }).join(" | ")
            : "...";
          compareBody.innerHTML = ''
            + '<tr><td>ANOVA F: ' + fmt(ob.anovaF) + '</td><td>Kruskal H: ' + fmt(ob.kwH) + '</td></tr>'
            + '<tr><td>Means: ' + meansSummary + '</td><td>Mean ranks: ' + meanRankSummary + '</td></tr>'
            + '<tr><td>η² / ω²: ' + fmt(ob.etaSquared) + ' / ' + fmt(ob.omegaSquared) + '</td><td>ε² / η²(H): ' + fmt(ob.epsilonSquared) + ' / ' + fmt(ob.etaSquaredH) + '</td></tr>'
            + '<tr><td>Post-hoc: Tukey / Games-Howell</td><td>Post-hoc: Dunn / Conover</td></tr>'
            + '<tr><td>Levene p: ' + fmtP((ob.levene || {}).p) + '</td><td>Tie/normality info: rank-based robust</td></tr>';
        }
      }
    }
    function renderPosthoc(posthoc, compareMode){
      const panel = document.getElementById("posthocPanel");
      const body = document.getElementById("posthocBody");
      if (!panel || !body) return;
      if (compareMode !== "k-plus" || !posthoc || !posthoc.enabled) {
        panel.style.display = "none";
        body.innerHTML = '<tr><td colspan="5">No post-hoc rows</td></tr>';
        return;
      }
      panel.style.display = "block";
      const rows = posthoc.rows || [];
      if (!rows.length) {
        body.innerHTML = '<tr><td colspan="5">No post-hoc rows</td></tr>';
        return;
      }
      body.innerHTML = "";
      const MAX_RENDER = 200;
      const clipped = rows.length > MAX_RENDER;
      const rowsToRender = clipped ? rows.slice(0, MAX_RENDER) : rows;
      rowsToRender.forEach(function(r){
        const tr = document.createElement("tr");
        [r.comparison, r.statistic, fmtP(r.rawP), fmtP(r.adjP), fmt(r.estimate)].forEach(function(v){
          const td = document.createElement("td");
          td.textContent = v;
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
      if (clipped) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 5;
        td.textContent = "Showing first " + MAX_RENDER + " of " + rows.length + " post-hoc rows for responsiveness.";
        td.style.opacity = "0.8";
        tr.appendChild(td);
        body.appendChild(tr);
      }
    }

    function populateBundle(b){
      lastBundle = b || {};
      const s=b.setup||{}, e=b.explore||{}, a=b.assumptions||{}, r=b.results||{}, fx=b.effects||{}, p=b.power||{}, rep=b.report||{};
      availableHeaders = Array.isArray(s.headers) ? s.headers.slice() : availableHeaders;
      persistedColumns.groupA = s.groupA || persistedColumns.groupA;
      persistedColumns.groupB = s.groupB || persistedColumns.groupB;
      persistedColumns.valueColumn = s.valueColumn || persistedColumns.valueColumn;
      persistedColumns.groupColumn = s.groupColumn || persistedColumns.groupColumn;
      currentCompareMode = "k-plus";
      currentPrimaryTest = s.primaryTest || currentPrimaryTest || "welch";
      var testSel = document.getElementById("setPrimaryTest");
      if (testSel) testSel.value = currentPrimaryTest;
      setFrameworkButtons(s.primaryFramework || primaryFramework);
      var alphaEl = document.getElementById("setAlpha");
      if (alphaEl) alphaEl.value = String(1 - (parseMaybeNumber(s.confidence) || 0.95));
      var orientation = s.hypothesis || "two-sided";
      currentHypothesis = orientation;
      var radio = document.querySelector('input[name="h1Orientation"][value="' + orientation + '"]');
      if (radio) radio.checked = true;
      const phm = document.getElementById("setPosthocMethod"); if (phm) phm.value = s.posthocMethod || "games-howell";
      const phc = document.getElementById("setPosthocCorrection"); if (phc) phc.value = s.posthocCorrection || "holm";
      renderCompareStatsRow(s, e);
      refreshSettingsVisibility();
      updatePosthocOptions();
      const ksum = e.kplusSummary || {};
      const ob = r.omnibus || {};
      setText("expVarCount", isFinite(parseMaybeNumber(ksum.variableCount)) ? fmt(ksum.variableCount) : ((s.groupLevels || []).length || "..."));
      setText("expTotalN", isFinite(parseMaybeNumber(ksum.totalN)) ? fmt(ksum.totalN) : "...");
      setText("expLevels", isFinite(parseMaybeNumber(ksum.levelsCount)) ? fmt(ksum.levelsCount) : "...");
      setText("expOverallMean", isFinite(parseMaybeNumber(ksum.meanOverall)) ? fmt(ksum.meanOverall) : "...");
      setText("expFramework", primaryFramework === "nonparametric" ? "Nonparametric (ranks)" : "Parametric (means)");
      setText("asLeveneP", fmtP((ob.levene || {}).p));
      setText("asBfP", fmtP((ob.brownForsythe || {}).p));
      setText("asWelchP", fmtP((ob.welchAnova || {}).p));
      setText("asReco", a.recommendation);
      updateResultsPanels(r, fx, s, 1 - (parseMaybeNumber(s.confidence) || 0.95));
      renderPosthoc(r.posthoc || {}, "k-plus");
      setText("efEta", fmt(ob.etaSquared)); setText("efCohenF", fmt(ob.cohenF)); setText("efAnovaF", fmt(ob.anovaF)); setText("efKwH", fmt(ob.kwH));
      setText("powNote", p.note); setText("powEndpoint", p.suggestedEndpoint); setText("powVal", fmt(p.placeholderPower));
      setText("repAnova", "ANOVA: F(" + fmt(ob.anovaDf1) + ", " + fmt(ob.anovaDf2) + ") = " + fmt(ob.anovaF) + ", p " + fmtP(ob.anovaP) + ".");
      setText("repKw", "Kruskal-Wallis: H(" + fmt(ob.kwDf) + ") = " + fmt(ob.kwH) + ", p " + fmtP(ob.kwP) + ".");
      setText("repCons", rep.consistency);
    }
    function saveCurrentModel(){ sendToHost("saveIndependentModel", lastBundle||{}); }
    function exportHtml(){
      const blob = new Blob([document.documentElement.outerHTML], {type:"text/html"});
      const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "independent-means-report.html"; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),500);
    }
    document.addEventListener("DOMContentLoaded", function(){
      document.querySelectorAll(".tab-button").forEach(btn=>btn.addEventListener("click",()=>switchTab(btn.getAttribute("data-tab"))));
      ["setAlpha","setPosthocMethod","setPosthocCorrection","setPrimaryTest"].forEach(function(id){
        const el = document.getElementById(id);
        if (el) el.addEventListener("change", function(){
          if (id === "setPrimaryTest") {
            currentPrimaryTest = el.value || "welch";
            setFrameworkButtons(primaryFramework);
          }
          notifySettingsChanged();
        });
      });
      document.querySelectorAll('input[name="h1Orientation"]').forEach(function(el){ el.addEventListener("change", notifySettingsChanged); });
      var rp = document.getElementById("fwParametric");
      var rn = document.getElementById("fwNonparametric");
      if (rp) rp.addEventListener("change", function(){ if (rp.checked) { setFrameworkButtons("parametric"); notifySettingsChanged(); } });
      if (rn) rn.addEventListener("change", function(){ if (rn.checked) { setFrameworkButtons("nonparametric"); notifySettingsChanged(); } });
      setFrameworkButtons(primaryFramework);
      refreshSettingsVisibility();
      Office.onReady(function(){
        Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived, function(arg){
          const msg = JSON.parse(arg.message||"{}");
          if(msg.type==="INDEPENDENT_BUNDLE") populateBundle(msg.payload||{});
        });
        sendToHost("independentDashboardReady",{});
        setTimeout(()=>sendToHost("independentDashboardReady",{}),500);
      });
    });
  </script>
</body>
</html>
