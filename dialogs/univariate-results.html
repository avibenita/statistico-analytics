<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Univariate Analysis Results</title>
    
    <!-- Office.js -->
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
    
    <!-- Shared Results Dialog CSS -->
    <link rel="stylesheet" href="../src/shared/css/results-dialog.css">
</head>
<body>
    <div class="results-container">
        <!-- Header with Dropdown Navigation -->
        <div class="dialog-header">
            <h1><i class="fa-solid fa-chart-simple"></i> <span id="pageTitle">Descriptive Statistics</span></h1>
            <div class="dialog-header-controls">
                <div class="dropdown-container" id="navDropdown">
                    <button class="dropdown-btn" onclick="toggleDropdown()">
                        <i class="fa-solid fa-bars"></i>
                        Analysis Menu
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="dropdown-content">
                        <a onclick="showView('descriptive')" class="selected" id="nav-descriptive">
                            <span class="nav-icon"><i class="fa-solid fa-table"></i></span>Descriptive Statistics
                        </a>
                        <a onclick="showView('distribution')" id="nav-distribution">
                            <span class="nav-icon"><i class="fa-solid fa-chart-area"></i></span>Distribution Analysis
                        </a>
                        <a onclick="showView('normality')" id="nav-normality">
                            <span class="nav-icon"><i class="fa-solid fa-vial"></i></span>Normality Tests
                        </a>
                        <div class="dropdown-separator"></div>
                        <a onclick="showView('histogram')" id="nav-histogram">
                            <span class="nav-icon"><i class="fa-solid fa-chart-column"></i></span>Histogram
                        </a>
                        <a onclick="showView('boxplot')" id="nav-boxplot">
                            <span class="nav-icon"><i class="fa-solid fa-box"></i></span>Box Plot
                        </a>
                        <a onclick="showView('qqplot')" id="nav-qqplot">
                            <span class="nav-icon"><i class="fa-solid fa-chart-scatter"></i></span>Q-Q Plot
                        </a>
                    </div>
                </div>
                <button class="close-btn" onclick="closeDialog()">
                    <i class="fa-solid fa-times"></i> Close
                </button>
            </div>
        </div>

        <!-- Results Content -->
        <div id="resultsContent">
            <div class="loading">
                <div class="spinner"></div>
                <div>Loading results...</div>
            </div>
        </div>
    </div>

    <!-- Shared Results Dialog JS -->
    <script src="../src/shared/js/components/ResultsDialog.js"></script>
    
    <!-- Module-specific display functions -->
    <script>
        // Initialize with available views
        initResultsDialog({
            defaultView: 'descriptive',
            storageKey: 'univariateResults',
            views: {
                descriptive: displayDescriptiveView,
                distribution: displayDistributionView,
                normality: displayNormalityView,
                histogram: displayHistogramView,
                boxplot: displayBoxPlotView,
                qqplot: displayQQPlotView
            }
        });

        /**
         * Descriptive Statistics View
         */
        function displayDescriptiveView(data) {
            if (!data) return;
            
            updatePageTitle('Descriptive Statistics');
            
            const { n, descriptive, dataSource, transform } = data;
            
            const html = `
                <!-- Sample Info -->
                <div class="stats-container">
                    <div class="stat-panel">
                        <div class="stat-panel-heading"><i class="fa-solid fa-info-circle"></i> Sample Information</div>
                        <div class="stat-panel-body">
                            <div class="stat-field">
                                <span class="stat-label">Sample Size:</span>
                                <span class="stat-value">${n}</span>
                            </div>
                            <div class="stat-field">
                                <span class="stat-label">Data Source:</span>
                                <span class="stat-value">${dataSource}</span>
                            </div>
                            <div class="stat-field">
                                <span class="stat-label">Transform:</span>
                                <span class="stat-value">${transform || 'None'}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Central Tendency -->
                <div class="table-container">
                    <div class="table-heading"><i class="fa-solid fa-chart-line"></i> Central Tendency</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Statistic</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Mean</td>
                                <td><strong>${descriptive.mean}</strong></td>
                            </tr>
                            <tr>
                                <td>Median (Q2)</td>
                                <td><strong>${descriptive.median}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Dispersion -->
                <div class="table-container">
                    <div class="table-heading"><i class="fa-solid fa-arrows-left-right"></i> Dispersion</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Statistic</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Standard Deviation</td>
                                <td><strong>${descriptive.stdDev}</strong></td>
                            </tr>
                            <tr>
                                <td>Variance</td>
                                <td><strong>${descriptive.variance}</strong></td>
                            </tr>
                            <tr>
                                <td>Range</td>
                                <td><strong>${descriptive.range}</strong></td>
                            </tr>
                            <tr>
                                <td>IQR (Interquartile Range)</td>
                                <td><strong>${descriptive.iqr}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Range & Quantiles -->
                <div class="table-container">
                    <div class="table-heading"><i class="fa-solid fa-ruler-horizontal"></i> Range & Quantiles</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Statistic</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Minimum</td>
                                <td><strong>${descriptive.min}</strong></td>
                            </tr>
                            <tr>
                                <td>Q1 (25th percentile)</td>
                                <td><strong>${descriptive.q1}</strong></td>
                            </tr>
                            <tr>
                                <td>Median (50th percentile)</td>
                                <td><strong>${descriptive.median}</strong></td>
                            </tr>
                            <tr>
                                <td>Q3 (75th percentile)</td>
                                <td><strong>${descriptive.q3}</strong></td>
                            </tr>
                            <tr>
                                <td>Maximum</td>
                                <td><strong>${descriptive.max}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
        }

        /**
         * Distribution Analysis View
         */
        function displayDistributionView(data) {
            if (!data) return;
            
            updatePageTitle('Distribution Analysis');
            
            const { descriptive } = data;
            const skew = parseFloat(descriptive.skewness);
            const kurt = parseFloat(descriptive.kurtosis);
            
            const skewInterpretation = Math.abs(skew) < 0.5 
                ? 'The distribution is approximately symmetric.'
                : skew > 0.5 
                    ? 'The distribution is positively skewed (right tail is longer).'
                    : 'The distribution is negatively skewed (left tail is longer).';
            
            const kurtInterpretation = Math.abs(kurt) < 0.5
                ? 'The distribution has approximately normal tailedness (mesokurtic).'
                : kurt > 0.5
                    ? 'The distribution has heavy tails (leptokurtic) - more prone to outliers.'
                    : 'The distribution has light tails (platykurtic) - less prone to outliers.';
            
            const html = `
                <div class="table-container">
                    <div class="table-heading"><i class="fa-solid fa-chart-area"></i> Distribution Shape</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Statistic</th>
                                <th>Value</th>
                                <th style="width: 50%;">Interpretation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Skewness</td>
                                <td><strong>${descriptive.skewness}</strong></td>
                                <td style="color: var(--text-secondary);">${skewInterpretation}</td>
                            </tr>
                            <tr>
                                <td>Kurtosis (Excess)</td>
                                <td><strong>${descriptive.kurtosis}</strong></td>
                                <td style="color: var(--text-secondary);">${kurtInterpretation}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="interpretation">
                    <strong><i class="fa-solid fa-lightbulb"></i> What This Means:</strong><br><br>
                    <strong>Skewness (${descriptive.skewness}):</strong> ${skewInterpretation}<br><br>
                    <strong>Kurtosis (${descriptive.kurtosis}):</strong> ${kurtInterpretation}<br><br>
                    A perfectly normal distribution would have skewness = 0 and kurtosis = 0.
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-chart-column"></i> Visual Analysis Recommended</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        Use the dropdown menu above to view:
                    </p>
                    <ul style="color: var(--text-secondary); line-height: 2; margin-top: 10px;">
                        <li><strong>Histogram</strong> - See the distribution shape visually</li>
                        <li><strong>Box Plot</strong> - Identify outliers and quartiles</li>
                        <li><strong>Q-Q Plot</strong> - Assess normality graphically</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
        }

        /**
         * Normality Tests View
         */
        function displayNormalityView(data) {
            if (!data) return;
            
            updatePageTitle('Normality Tests');
            
            const html = `
                <div class="note">
                    <strong><i class="fa-solid fa-flask"></i> Normality Testing</strong><br><br>
                    Full statistical normality tests (Shapiro-Wilk, Anderson-Darling, Kolmogorov-Smirnov) 
                    will be implemented in the next version of Statistico Analytics.
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-chart-simple"></i> Alternative: Visual Assessment</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 15px;">
                        For now, you can assess normality using:
                    </p>
                    <ul style="color: var(--text-secondary); line-height: 2;">
                        <li><strong>Distribution Analysis</strong> - Check skewness and kurtosis values</li>
                        <li><strong>Q-Q Plot</strong> - Visual normality assessment (most reliable)</li>
                        <li><strong>Histogram</strong> - See if distribution approximates bell curve</li>
                    </ul>
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-book"></i> General Guidelines</h3>
                    <ul style="color: var(--text-secondary); line-height: 2;">
                        <li>Skewness between -0.5 and 0.5 suggests approximate symmetry</li>
                        <li>Kurtosis between -0.5 and 0.5 suggests normal tailedness</li>
                        <li>Q-Q plot points should fall close to the diagonal line</li>
                        <li>Histogram should approximate a bell-shaped curve</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
        }

        /**
         * Histogram View
         */
        function displayHistogramView(data) {
            if (!data) return;
            
            updatePageTitle('Histogram');
            
            const html = `
                <div class="note">
                    <strong><i class="fa-solid fa-chart-column"></i> Interactive Histogram</strong><br><br>
                    Interactive histogram visualization will be added in the next update.
                    This will include:
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-wand-magic-sparkles"></i> Planned Features</h3>
                    <ul style="color: var(--text-secondary); line-height: 2;">
                        <li>Interactive histogram with adjustable bin width</li>
                        <li>Overlay of normal distribution curve</li>
                        <li>Frequency and density display options</li>
                        <li>Export as image for reports</li>
                    </ul>
                </div>

                <div class="interpretation">
                    <strong><i class="fa-solid fa-circle-info"></i> Current Workaround:</strong><br><br>
                    Use Excel's built-in charting:
                    <ol style="margin-top: 10px; line-height: 2;">
                        <li>Select your data in Excel</li>
                        <li>Insert → Charts → Histogram</li>
                        <li>Format as needed</li>
                    </ol>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
        }

        /**
         * Box Plot View
         */
        function displayBoxPlotView(data) {
            if (!data) return;
            
            updatePageTitle('Box Plot');
            
            const { descriptive } = data;
            
            const html = `
                <div class="note">
                    <strong><i class="fa-solid fa-box"></i> Box Plot Visualization</strong><br><br>
                    Interactive box plot will be added in the next update.
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-chart-simple"></i> Box Plot Summary</h3>
                    <table style="width: 100%; margin-top: 15px;">
                        <thead>
                            <tr>
                                <th>Component</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Minimum</td>
                                <td><strong>${descriptive.min}</strong></td>
                            </tr>
                            <tr>
                                <td>Q1 (Lower Quartile)</td>
                                <td><strong>${descriptive.q1}</strong></td>
                            </tr>
                            <tr>
                                <td>Median</td>
                                <td><strong>${descriptive.median}</strong></td>
                            </tr>
                            <tr>
                                <td>Q3 (Upper Quartile)</td>
                                <td><strong>${descriptive.q3}</strong></td>
                            </tr>
                            <tr>
                                <td>Maximum</td>
                                <td><strong>${descriptive.max}</strong></td>
                            </tr>
                            <tr style="background: var(--surface-2);">
                                <td>IQR (Q3 - Q1)</td>
                                <td><strong>${descriptive.iqr}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="interpretation">
                    <strong><i class="fa-solid fa-lightbulb"></i> Outlier Detection:</strong><br><br>
                    Potential outliers typically fall outside:<br>
                    • Lower fence: Q1 - 1.5 × IQR = ${(parseFloat(descriptive.q1) - 1.5 * parseFloat(descriptive.iqr)).toFixed(2)}<br>
                    • Upper fence: Q3 + 1.5 × IQR = ${(parseFloat(descriptive.q3) + 1.5 * parseFloat(descriptive.iqr)).toFixed(2)}
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
        }

        /**
         * Q-Q Plot View
         */
        function displayQQPlotView(data) {
            if (!data) return;
            
            updatePageTitle('Q-Q Plot (Normality Assessment)');
            
            const html = `
                <div class="note">
                    <strong><i class="fa-solid fa-chart-scatter"></i> Q-Q Plot Visualization</strong><br><br>
                    Interactive Q-Q plot will be added in the next update.
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-book"></i> What is a Q-Q Plot?</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        A Quantile-Quantile (Q-Q) plot is a graphical tool to assess if a dataset follows 
                        a theoretical distribution (typically the normal distribution).
                    </p>
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-glasses"></i> How to Interpret</h3>
                    <ul style="color: var(--text-secondary); line-height: 2;">
                        <li><strong>Points on the line:</strong> Data follows normal distribution</li>
                        <li><strong>S-shaped curve:</strong> Heavy-tailed distribution</li>
                        <li><strong>Inverted S-curve:</strong> Light-tailed distribution</li>
                        <li><strong>Points deviate at ends:</strong> Potential outliers</li>
                    </ul>
                </div>

                <div class="interpretation">
                    <strong><i class="fa-solid fa="circle-info"></i> Tip:</strong><br><br>
                    The Q-Q plot is generally more reliable than histogram for assessing normality, 
                    especially with smaller sample sizes.
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
        }
    </script>
</body>
</html>
