<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Univariate Analysis Results</title>
  
  <!-- Office.js -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
  
  <!-- Highcharts for Charts -->
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-more.js"></script>
  <script src="https://code.highcharts.com/modules/histogram-bellcurve.js"></script>
  <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
  
  <!-- jStat for Statistical Calculations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.4/jstat.min.js"></script>
  
  <!-- Shared Results Dialog CSS -->
  <link rel="stylesheet" href="shared/css/results-dialog.css">
  
  <!-- Shared View Modules (Load after libraries) -->
  <script src="shared/views/histogram-view.js"></script>
  <script src="shared/views/boxplot-view.js"></script>
  <script src="shared/views/qqplot-view.js"></script>
  <script src="shared/views/normality-view.js"></script>
  <script src="shared/views/kernel-view.js"></script>
  
  <style>
    /* Dialog-specific styles loaded from shared/css/results-dialog.css */
    /* Add any dialog-specific overrides here if needed */
  </style>


    .header-center {
      text-align: center;
    }

    .header-view-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .header-variable {
      font-size: 14px;
      font-style: italic;
      color: var(--text-secondary);
    }

    /* Part 3: Right - Dropdown */
    .header-right {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 12px;
    }

    .dropdown-btn {
      padding: 8px 16px;
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .dropdown-btn:hover {
      border-color: var(--accent-1);
      box-shadow: 0 2px 4px rgba(249, 115, 22, 0.1);
    }

    .dropdown-content {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      min-width: 250px;
      display: none;
      z-index: 1000;
    }

    .dropdown-content.show { display: block; }

    .analysis-option {
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .analysis-option:hover {
      background: var(--surface-1);
    }

    .analysis-option.active {
      background: var(--surface-1);
      color: var(--accent-1);
      font-weight: 600;
    }

    .close-btn {
      padding: 8px 16px;
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .close-btn:hover {
      border-color: #dc2626;
      color: #dc2626;
    }

    /* Content - Flexible and scrollable */
    .content {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      width: 100%;
    }

    /* Statistics Panel */
    .stats-panel {
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .panel-heading {
      background: var(--surface-1);
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 15px;
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
    }

    .stats-table th {
      background: var(--surface-1);
      padding: 10px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .stats-table th.highlight {
      background: rgba(249, 115, 22, 0.1);
      color: var(--accent-1);
      font-weight: 700;
    }

    .stats-table td {
      padding: 12px;
      text-align: center;
      font-size: 13px;
      border-bottom: 1px solid var(--border);
    }

    .stats-table td.highlight {
      background: rgba(249, 115, 22, 0.05);
      color: var(--accent-1);
      font-weight: 700;
      font-size: 15px;
    }

    .stats-table tr:last-child td {
      border-bottom: none;
    }

    /* Histogram Panel */
    .histogram-panel {
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .histogram-controls {
      padding: 12px 16px;
      background: var(--surface-1);
      border-bottom: 1px solid var(--border);
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 12px;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-group label {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .control-group select {
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 12px;
      background: var(--surface-0);
    }

    .control-group input[type="range"] {
      width: 100px;
    }

    .control-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--accent-1);
    }

    .value-display {
      min-width: 40px;
      text-align: center;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 12px;
    }

    /* Range Controls for Data Cropping */
    .range-controls {
      padding: 16px;
      background: var(--surface-1);
      border-top: 1px solid var(--border);
    }

    .range-slider-row {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .slider-container {
      position: relative;
      flex: 1;
      height: 30px;
      display: flex;
      align-items: center;
    }

    .slider-track {
      position: absolute;
      width: 100%;
      height: 6px;
      background: var(--surface-2);
      border-radius: 3px;
      pointer-events: none;
    }

    .active-range {
      position: absolute;
      height: 6px;
      background: var(--accent-1);
      border-radius: 3px;
      pointer-events: none;
      left: 0%;
      width: 100%;
      z-index: 0;
    }

    .slider-container input[type="range"] {
      position: absolute;
      width: 100%;
      background: transparent;
      pointer-events: all;
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }

    .slider-container input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: transparent;
      border-radius: 3px;
    }

    .slider-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent-2);
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      margin-top: -6px;
    }

    .slider-container input[type="range"]::-moz-range-track {
      height: 6px;
      background: transparent;
      border-radius: 3px;
    }

    .slider-container input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent-2);
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* Remove z-index from CSS - will be set inline in HTML */

    .reset-button {
      background: var(--surface-0);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 12px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .reset-button:hover {
      border-color: var(--accent-1);
      color: var(--accent-1);
      background: var(--surface-2);
    }

    .range-display {
      margin-top: 8px;
      text-align: center;
    }

    #histogram-chart {
      padding: 16px;
      width: 100%;
      height: clamp(400px, 55vh, 700px); /* Taller for better visibility */
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    /* Box Plot Panels */
    .boxplot-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .boxplot-panel {
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    #boxWithOutliers,
    #boxWithoutOutliers {
      width: 100%;
      height: clamp(250px, 30vh, 350px);
      padding: 16px;
    }

    /* QQ/PP Plot Styles */
    .qqpp-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .qqpp-panel {
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    #plot1,
    #plot2,
    #qqPlot,
    #ppPlot {
      width: 100%;
      height: clamp(280px, 35vh, 400px);
      padding: 12px;
    }

    /* Radio button styling */
    input[type="radio"] {
      accent-color: var(--accent-1);
      cursor: pointer;
    }

    input[type="radio"]:checked + span {
      color: var(--accent-1);
      font-weight: 600;
    }

    /* Normality Tests Styles */
    .normality-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .normality-summary {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .normality-gauge {
      flex: 1;
      min-width: 200px;
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }

    #normalityGauge {
      height: 180px;
    }

    .normality-stats {
      flex: 2;
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
    }

    .stat-box {
      text-align: center;
      padding: 12px;
      background: var(--surface-1);
      border-radius: 6px;
    }

    .stat-box-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-1);
      margin-bottom: 4px;
    }

    .stat-box-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .tests-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
    }

    .test-card {
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 14px;
    }

    .test-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .test-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
    }

    .test-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .test-badge.pass {
      background: rgba(46, 204, 113, 0.15);
      color: #2ecc71;
    }

    .test-badge.fail {
      background: rgba(231, 76, 60, 0.15);
      color: #e74c3c;
    }

    .test-details {
      font-size: 12px;
    }

    .test-detail-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid var(--border);
    }

    .test-detail-row:last-child {
      border-bottom: none;
    }

    .test-detail-label {
      color: var(--text-muted);
    }

    .test-detail-value {
      color: var(--text-primary);
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }

    /* Kernel Density Styles */
    .kernel-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .kernel-controls {
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }

    .kernel-control-group {
      flex: 1;
      min-width: 200px;
    }

    .kernel-control-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: block;
    }

    .kernel-slider {
      width: 100%;
    }

    .kernel-value-display {
      font-size: 13px;
      color: var(--accent-1);
      font-weight: 700;
      margin-top: 4px;
    }

    #kernelChart {
      width: 100%;
      height: clamp(450px, 60vh, 750px); /* Much taller to fill available space */
      padding: 16px;
      background: var(--surface-0);
      border: 1.5px solid var(--border);
      border-radius: 8px;
    }

    .spinner {
      border: 3px solid var(--border);
      border-top: 3px solid var(--accent-1);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Floating Close Button */
    .close-btn-floating {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 54px;
      height: 54px;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 22px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .close-btn-floating:hover {
      background: #b91c1c;
      box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
      transform: scale(1.08);
    }

    .close-btn-floating:active {
      transform: scale(0.95);
    }

    /* ===== DARK THEME ===== */
    body.theme-dark {
      --surface-0: #0c1624;
      --surface-1: #1a1f2e;
      --surface-2: #242938;
      --border: #2d3748;
      --accent-1: rgb(255,165,120);
      --accent-2: rgb(120,200,255);
      --text-primary: #ffffff;
      --text-secondary: rgba(255,255,255,0.8);
      --text-muted: rgba(255,255,255,0.6);
      background-color: #0c1624;
    }

    body.theme-dark .header {
      background: #1a1f2e;
      border-bottom: 1px solid #2d3748;
    }

    body.theme-dark .header-logo {
      background: linear-gradient(135deg, rgb(255,165,120), rgb(120,200,255));
    }

    body.theme-dark .header-view-name,
    body.theme-dark .header-module-name {
      color: #ffffff;
    }

    body.theme-dark .header-brand,
    body.theme-dark .header-variable {
      color: rgba(255,255,255,0.7);
    }

    body.theme-dark .dropdown-btn {
      background: #242938;
      border-color: #2d3748;
      color: #ffffff;
    }

    body.theme-dark .dropdown-btn:hover {
      border-color: rgb(255,165,120);
      background: #2d3748;
    }

    body.theme-dark .dropdown-content {
      background: #1a1f2e;
      border-color: #2d3748;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    body.theme-dark .analysis-option {
      color: rgba(255,255,255,0.9);
    }

    body.theme-dark .analysis-option:hover {
      background: #242938;
      color: rgb(255,165,120);
    }

    body.theme-dark .analysis-option.active {
      background: #242938;
      color: rgb(255,165,120);
    }

    body.theme-dark .stats-panel {
      background: #1a1f2e;
      border-color: #2d3748;
    }

    body.theme-dark .boxplot-panel {
      background: #1a1f2e;
      border-color: #2d3748;
    }

    body.theme-dark .qqpp-panel,
    body.theme-dark .normality-gauge,
    body.theme-dark .normality-stats,
    body.theme-dark .test-card,
    body.theme-dark .kernel-controls,
    body.theme-dark #kernelChart {
      background: #1a1f2e;
      border-color: #2d3748;
    }

    body.theme-dark .stat-box {
      background: #242938;
    }

    body.theme-dark .test-badge.pass {
      background: rgba(46, 204, 113, 0.2);
      color: #2ecc71;
    }

    body.theme-dark .test-badge.fail {
      background: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
    }

    body.theme-dark .panel-heading {
      background: #242938;
      border-bottom-color: #2d3748;
      color: #ffffff;
    }

    body.theme-dark .stats-table th {
      background: #242938;
      color: rgba(255,255,255,0.9);
      border-bottom-color: #2d3748;
    }

    body.theme-dark .stats-table th.highlight {
      background: rgba(255, 165, 120, 0.2);
      color: rgb(255,165,120);
    }

    body.theme-dark .stats-table td {
      color: rgba(255,255,255,0.8);
      border-bottom-color: #2d3748;
    }

    body.theme-dark .stats-table td.highlight {
      background: rgba(255, 165, 120, 0.1);
      color: rgb(255,165,120);
    }

    body.theme-dark .histogram-panel {
      background: #1a1f2e;
      border-color: #2d3748;
    }

    body.theme-dark .histogram-controls {
      background: #242938;
      border-bottom-color: #2d3748;
    }

    body.theme-dark .control-group label {
      color: rgba(255,255,255,0.8);
    }

    body.theme-dark .control-group select {
      background: #1a1f2e;
      color: #ffffff;
      border-color: #2d3748;
    }

    body.theme-dark .range-controls {
      background: #242938;
      border-top-color: #2d3748;
    }

    body.theme-dark .slider-track {
      background: #1a1f2e;
    }

    body.theme-dark .active-range {
      background: rgb(255,165,120);
    }

    body.theme-dark .range-slider-row {
      color: rgba(255,255,255,0.8);
    }

    body.theme-dark .value-display {
      color: #ffffff;
    }

    body.theme-dark .reset-button {
      background: #1a1f2e;
      color: rgba(255,255,255,0.8);
      border-color: #2d3748;
    }

    body.theme-dark .reset-button:hover {
      border-color: rgb(255,165,120);
      color: rgb(255,165,120);
    }

    body.theme-dark .close-btn-floating {
      background: #dc2626;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);
    }

    /* Highcharts dark theme overrides */
    body.theme-dark .highcharts-background {
      fill: #1a1f2e !important;
    }

    body.theme-dark .highcharts-title,
    body.theme-dark .highcharts-axis-title,
    body.theme-dark .highcharts-axis-labels,
    body.theme-dark .highcharts-legend-item text {
      fill: #ffffff !important;
    }

    body.theme-dark .highcharts-grid-line {
      stroke: #2d3748 !important;
    }

    body.theme-dark .highcharts-tooltip-box {
      fill: #242938 !important;
      stroke: #2d3748 !important;
    }

    body.theme-dark .highcharts-tooltip text {
      fill: #ffffff !important;
    }

    /* ===== RESPONSIVE DESIGN FOR RESULTS DIALOG ===== */

    /* Adjust header for smaller screens */
    @media (max-width: 768px) {
      .header {
        padding: 12px 16px;
        grid-template-columns: 1fr;
        gap: 12px;
        text-align: center;
      }

      .header-left,
      .header-center,
      .header-right {
        justify-content: center;
      }

      .header-view-name {
        font-size: 16px;
      }

      .header-variable {
        font-size: 12px;
      }

      .content {
        padding: 12px;
      }
    }

    /* Compact tables on small screens */
    @media (max-width: 640px) {
      .stats-table {
        font-size: 11px;
      }

      .stats-table th,
      .stats-table td {
        padding: 8px 6px;
      }

      .panel-heading {
        padding: 10px 12px;
        font-size: 14px;
      }

      .histogram-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }

      .control-group {
        justify-content: space-between;
      }

      #histogram-chart {
        height: clamp(350px, 45vh, 550px);
      }

      #kernelChart {
        height: clamp(350px, 50vh, 600px);
      }

      #boxWithOutliers,
      #boxWithoutOutliers {
        height: clamp(200px, 28vh, 300px);
      }

      .qqpp-container {
        grid-template-columns: 1fr;
      }

      #plot1,
      #plot2,
      #qqPlot,
      #ppPlot {
        height: clamp(250px, 30vh, 320px);
      }

      .tests-grid {
        grid-template-columns: 1fr;
      }

      #normalityGauge {
        height: 150px;
      }
    }

    /* Very small screens - Stack statistics */
    @media (max-width: 480px) {
      .stats-table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .header-logo {
        width: 30px;
        height: 30px;
        font-size: 16px;
      }

      .header-module-name {
        font-size: 13px;
      }

      .header-brand {
        font-size: 10px;
      }

      .dropdown-btn {
        font-size: 11px;
        padding: 6px 12px;
      }

      .content {
        padding: 10px;
      }

      .stats-panel {
        margin-bottom: 12px;
      }

      #histogram-chart {
        padding: 10px;
        height: clamp(300px, 40vh, 450px);
      }

      #boxWithOutliers,
      #boxWithoutOutliers {
        height: clamp(180px, 25vh, 280px);
        padding: 10px;
      }

      .boxplot-container {
        gap: 12px;
      }

      .normality-summary {
        flex-direction: column;
      }

      .normality-stats {
        grid-template-columns: repeat(2, 1fr);
      }

      #kernelChart {
        height: clamp(300px, 45vh, 500px);
      }

      .kernel-controls {
        flex-direction: column;
        gap: 12px;
      }

      .range-slider-row {
        font-size: 11px;
        gap: 6px;
      }

      .value-display {
        min-width: 40px;
        font-size: 11px;
      }

      .reset-button {
        padding: 4px 8px;
        font-size: 10px;
      }

      .close-btn-floating {
        width: 44px;
        height: 44px;
        bottom: 16px;
        right: 16px;
        font-size: 18px;
      }
    }

    /* Landscape mode - maximize vertical space */
    @media (orientation: landscape) and (max-height: 600px) {
      .header {
        padding: 10px 16px;
      }

      .header-view-name {
        font-size: 16px;
        margin-bottom: 2px;
      }

      .header-variable {
        font-size: 12px;
      }

      .content {
        padding: 12px;
      }

      .stats-panel {
        margin-bottom: 12px;
      }

      .panel-heading {
        padding: 8px 12px;
      }

      .stats-table th,
      .stats-table td {
        padding: 6px 8px;
      }

      #histogram-chart {
        height: clamp(250px, 50vh, 400px);
        padding: 10px;
      }

      #kernelChart {
        height: clamp(250px, 55vh, 450px);
      }

      #boxWithOutliers,
      #boxWithoutOutliers {
        height: clamp(180px, 35vh, 260px);
        padding: 10px;
      }

      .histogram-controls {
        padding: 8px 12px;
      }

      .range-controls {
        padding: 10px 12px;
      }
    }

    /* Ensure content fits within viewport */
    @media (max-height: 700px) {
      .content {
        padding: 12px;
      }

      .stats-panel {
        margin-bottom: 10px;
      }

      #histogram-chart {
        height: clamp(300px, 45vh, 500px);
      }

      #kernelChart {
        height: clamp(300px, 50vh, 550px);
      }

      #boxWithOutliers,
      #boxWithoutOutliers {
        height: clamp(200px, 30vh, 320px);
      }
    }

    @media (max-height: 500px) {
      .stats-panel {
        margin-bottom: 8px;
      }

      .panel-heading {
        padding: 6px 10px;
        font-size: 13px;
      }

      .stats-table {
        font-size: 11px;
      }

      .stats-table th,
      .stats-table td {
        padding: 4px 6px;
      }

      #histogram-chart {
        height: clamp(200px, 40vh, 300px);
        padding: 8px;
      }

      #kernelChart {
        height: clamp(200px, 45vh, 350px);
      }

      #boxWithOutliers,
      #boxWithoutOutliers {
        height: clamp(140px, 25vh, 220px);
        padding: 8px;
      }

      .boxplot-container {
        gap: 8px;
      }

      .histogram-controls {
        padding: 6px 10px;
      }

      .range-controls {
        padding: 8px 10px;
      }
    }

    /* Touch devices - bigger touch targets */
    @media (pointer: coarse) {
      .dropdown-btn,
      .reset-button,
      .analysis-option {
        min-height: 44px;
      }

      .control-group input[type="range"] {
        height: 44px;
      }
    }
  </style>
</head>
<body>
  <!-- Header - 3 Parts -->
  <div class="header">
    <!-- Part 1: Logo + Module Name -->
    <div class="header-left">
      <div class="header-logo">
        <i class="fa-solid fa-chart-line"></i>
      </div>
      <div class="header-module">
        <div class="header-brand">Statistico Analytics</div>
        <div class="header-module-name">Univariate Analysis</div>
      </div>
    </div>

    <!-- Part 2: Center - View Name + Variable -->
    <div class="header-center">
      <div class="header-view-name" id="viewName">Interactive Histogram</div>
      <div class="header-variable">
        <span id="variableName">Variable</span> <span id="sampleSize">(n=--)</span>
      </div>
    </div>

    <!-- Part 3: Right - Dropdown -->
    <div class="header-right">
      <div style="position: relative;">
        <button class="dropdown-btn" onclick="toggleDropdown()">
          <i class="fa-solid fa-bars"></i>
          Advanced Results
          <i class="fa-solid fa-chevron-down"></i>
        </button>
        <div class="dropdown-content" id="dropdownMenu">
          <div class="analysis-option active" onclick="showView('histogram')">
            <i class="fa-solid fa-chart-column"></i>
            Histogram & Stats
          </div>
          <div class="analysis-option" onclick="showView('boxplot')">
            <i class="fa-solid fa-box"></i>
            Box Plot
          </div>
          <div class="analysis-option" onclick="showView('qqplot')">
            <i class="fa-solid fa-chart-scatter"></i>
            Q-Q Plot
          </div>
          <div class="analysis-option" onclick="showView('normality')">
            <i class="fa-solid fa-vial"></i>
            Normality Tests
          </div>
          <div class="analysis-option" onclick="showView('kernel')">
            <i class="fa-solid fa-wave-square"></i>
            Kernel Density
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="content" id="resultsContent">
    <div class="loading">
      <div class="spinner"></div>
      <div>Loading results...</div>
    </div>
  </div>

  <script>
    /**
     * Core Framework - Manages results dialog lifecycle
     * All view-specific logic is in shared/views/*.js modules
     */
    
    // Global variables
    let resultsData = null;

    // Apply theme from localStorage
    function applyTheme() {
      const theme = localStorage.getItem('resultsTheme') || 'light';
      document.body.classList.remove('theme-light', 'theme-dark');
      document.body.classList.add(`theme-${theme}`);
    }

    // Load results when page is ready
    if (typeof Office !== 'undefined') {
      Office.onReady(() => {
        applyTheme();
        loadResults();
      });
    } else {
      // Fallback if Office.js not available
      window.addEventListener('DOMContentLoaded', () => {
        applyTheme();
        loadResults();
      });
    }

    function loadResults() {
      const dataJSON = localStorage.getItem('univariateResults');
      if (dataJSON) {
        resultsData = JSON.parse(dataJSON);
        displayHistogramView();
      } else {
        document.getElementById('resultsContent').innerHTML = `
          <div class="loading">
            <i class="fa-solid fa-exclamation-triangle" style="font-size: 40px; color: #dc2626; margin-bottom: 16px;"></i>
            <div style="color: #dc2626;">No results data found</div>
          </div>
        `;
      }
    }

    /**
     * Change analysis view (called from dropdown menu)
     * All display functions are in shared/views/*.js modules
     */
    function showView(viewName) {
      const viewTitles = {
        'histogram': 'Interactive Histogram',
        'boxplot': 'Box Plot Analysis',
        'qqplot': 'Q-Q Plot Analysis',
        'normality': 'Normality Tests',
        'kernel': 'Kernel Density Estimation'
      };
      
      // Update view name in header
      document.getElementById('viewName').textContent = viewTitles[viewName] || 'Analysis';
      
      // Update active state
      document.querySelectorAll('.analysis-option').forEach(opt => opt.classList.remove('active'));
      if (event && event.target) {
        event.target.closest('.analysis-option').classList.add('active');
      }
      
      // Close dropdown
      document.getElementById('dropdownMenu').classList.remove('show');
      
      // Call appropriate view display function (from external modules)
      switch(viewName) {
        case 'histogram':
          displayHistogramView();
          break;
        case 'boxplot':
          displayBoxPlotView();
          break;
        case 'qqplot':
          displayQQPlotView();
          break;
        case 'normality':
          displayNormalityView();
          break;
        case 'kernel':
          displayKernelView();
          break;
        default:
          document.getElementById('resultsContent').innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
              <i class="fa-solid fa-info-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
              <div>${viewTitles[viewName] || 'View'} coming soon!</div>
            </div>
          `;
      }
    }

    /**
     * Toggle dropdown menu
     */
    function toggleDropdown() {
      document.getElementById('dropdownMenu').classList.toggle('show');
    }

    /**
     * Close dialog window
     */
    function closeDialog() {
      try {
        if (typeof Office !== 'undefined' && Office.context && Office.context.ui) {
          Office.context.ui.messageParent(JSON.stringify({ action: 'closeDialog' }));
        }
        window.close();
      } catch (e) {
        console.error('Error closing dialog:', e);
        try {
          window.close();
        } catch (e2) {
          console.error('Could not close window:', e2);
        }
      }
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      const dropdown = document.getElementById('dropdownMenu');
      if (dropdown && !e.target.closest('.dropdown-btn') && !e.target.closest('.dropdown-content')) {
        dropdown.classList.remove('show');
      }
    });
  </script>

  <!-- Floating Close Button -->
  <button class="close-btn-floating" onclick="closeDialog()" title="Close Dialog">
    <i class="fa-solid fa-times"></i>
  </button>
</body>
</html>
